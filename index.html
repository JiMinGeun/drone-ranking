<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë“œë¡  ê²½ì£¼ ì‹¤ì‹œê°„ ìˆœìœ„</title>
  <style>
    :root { --card: rgba(0,0,0,.22); --glass: rgba(255,255,255,.12); }
    *{box-sizing:border-box}
    body { font-family: 'Noto Sans KR', sans-serif; background: linear-gradient(135deg,#0ea5e9,#06b6d4); color:#fff; margin:0; min-height:100vh; display:flex; flex-direction:column; align-items:center; gap:14px; padding:16px; }
    h1 { margin: 10px 0 0; text-align:center; font-size: clamp(20px, 4vw, 28px); }
    .wrap { width:100%; max-width: 760px; display:flex; flex-direction:column; gap:12px; }
    .card { background:var(--card); backdrop-filter: blur(6px); border-radius:14px; padding:14px; box-shadow: 0 6px 20px rgba(0,0,0,.15); }
    table { width:100%; border-collapse: collapse; background: var(--glass); border-radius: 12px; overflow:hidden; }
    th,td { padding:10px; text-align:center; border-bottom:1px solid rgba(255,255,255,.28); }
    th { background: rgba(255,255,255,.18); font-weight:700; }
    tr:last-child td { border-bottom:none; }
    .row { display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
    input, select { flex:1 1 160px; min-width:140px; padding:10px 12px; border-radius:10px; border:none; outline:none; background:#fff; color:#111; }
    button { border:none; border-radius:10px; padding:10px 14px; font-weight:700; cursor:pointer; }
    .btn-primary { background:#ffeb3b; color:#111; }
    .btn-ghost { background:transparent; border:1px solid rgba(255,255,255,.5); color:#fff; }
    .admin-only { display:none; }
    .tag { display:inline-flex; padding:4px 8px; border-radius:999px; background:rgba(255,255,255,.2); font-size:12px; }
  </style>
</head>
<body>
  <h1>ğŸ ë“œë¡  ê²½ì£¼ ì‹¤ì‹œê°„ ìˆœìœ„</h1>
  <div class="wrap">

    <!-- ìƒë‹¨ ë°”: ê´€ë¦¬ì ë²„íŠ¼ / ìƒíƒœ -->
    <div class="card row" style="justify-content:space-between;">
      <div class="row" style="gap:6px">
        <span>ìƒíƒœ:</span>
        <span id="statusTag" class="tag">ê´€ëŒ ëª¨ë“œ</span>
      </div>
      <div class="row" style="gap:8px">
        <button id="adminBtn" class="btn-ghost">ğŸ” ê´€ë¦¬ì</button>
        <button id="logoutBtn" class="btn-ghost admin-only">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <!-- ìˆœìœ„í‘œ -->
    <div class="card">
      <table>
        <thead><tr><th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ê¸°ë¡(ì´ˆ)</th><th id="thActions" class="admin-only">ê´€ë¦¬</th></tr></thead>
        <tbody id="rankingBody"></tbody>
      </table>
    </div>

    <!-- ê´€ë¦¬ì ì…ë ¥ ì¹´ë“œ -->
    <div id="adminSection" class="card admin-only">
      <h3 style="margin:6px 0 10px">ê¸°ë¡ ì¶”ê°€/ìˆ˜ì •</h3>
      <div class="row">
        <input id="nameInput" type="text" placeholder="ì´ë¦„" />
        <input id="timeInput" type="number" step="0.01" placeholder="ê¸°ë¡(ì´ˆ)" />
        <button id="addBtn" class="btn-primary">ë“±ë¡ / ì—…ë°ì´íŠ¸</button>
      </div>
      <div class="row" style="margin-top:8px">
        <button id="resetBtn" class="btn-ghost">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
    </div>

  </div>

  <!-- âœ… Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>

  <script>
    // 1) Firebase ì„¤ì • (ì´ë¯¸ ë°œê¸‰ëœ ê°’)
    const firebaseConfig = {
      apiKey: "AIzaSyDQdYziYofadFexbv9CjgaSDoV701kJq7eo",
      authDomain: "studio-1121796292-145f8.firebaseapp.com",
      databaseURL: "https://studio-1121796292-145f8-default-rtdb.firebaseio.com",
      projectId: "studio-1121796292-145f8",
      storageBucket: "studio-1121796292-145f8.appspot.com",
      messagingSenderId: "505956643695",
      appId: "1:505956643695:web:6766fd9a4cb3b87d35409a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2) ê°„ì´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (í´ë¼ì´ì–¸íŠ¸ ë³´í˜¸ ìˆ˜ì¤€, ì†ŒìŠ¤ë³´ë©´ ë³´ì„)
    // í–‰ì‚¬ìš© ê°„í¸ ë³´í˜¸. ì§„ì§œ ë³´ì•ˆì´ í•„ìš”í•˜ë©´ Firebase Authenticationì„ ê¶Œì¥í•©ë‹ˆë‹¤.
    const ADMIN_PASSWORD = "dogae123!"; // â† ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½

    let isAdmin = false;

    // UI ìš”ì†Œ
    const tbody = document.getElementById('rankingBody');
    const thActions = document.getElementById('thActions');
    const adminSection = document.getElementById('adminSection');
    const adminBtn = document.getElementById('adminBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const statusTag = document.getElementById('statusTag');
    const nameInput = document.getElementById('nameInput');
    const timeInput = document.getElementById('timeInput');
    const addBtn = document.getElementById('addBtn');
    const resetBtn = document.getElementById('resetBtn');

    // ê´€ë¦¬ì í† ê¸€
    function applyAdminUI() {
      document.querySelectorAll('.admin-only').forEach(el => {
        el.style.display = isAdmin ? '' : 'none';
      });
      statusTag.textContent = isAdmin ? 'ê´€ë¦¬ì ëª¨ë“œ' : 'ê´€ëŒ ëª¨ë“œ';
      adminBtn.textContent = isAdmin ? 'ğŸ” ê´€ë¦¬ì(ON)' : 'ğŸ” ê´€ë¦¬ì';
    }

    adminBtn.onclick = () => {
      if (isAdmin) return; // ì´ë¯¸ ê´€ë¦¬ìë©´ ë¬´ì‹œ
      const pw = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
      if (pw === null) return;
      if (pw === ADMIN_PASSWORD) {
        isAdmin = true;
        applyAdminUI();
        alert('ê´€ë¦¬ì ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else {
        alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      }
    };

    logoutBtn.onclick = () => {
      isAdmin = false;
      applyAdminUI();
    };

    // ê¸°ë¡ ì¶”ê°€/ìˆ˜ì •
    addBtn.onclick = async () => {
      if (!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      const name = (nameInput.value||'').trim();
      const time = parseFloat(timeInput.value);
      if (!name || isNaN(time)) return alert('ì´ë¦„ê³¼ ê¸°ë¡(ì´ˆ)ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      await db.ref('participants/' + name).set({ name, time });
      nameInput.value = ''; timeInput.value = '';
    };

    // ì „ì²´ ì´ˆê¸°í™” (ì£¼ì˜)
    resetBtn.onclick = async () => {
      if (!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      const ok = confirm('ì •ë§ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”? (ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ)');
      if (!ok) return;
      await db.ref('participants').remove();
    };

    // í¸ì§‘/ì‚­ì œ í•¸ë“¤ëŸ¬
    function editRecord(name, time){
      if (!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      nameInput.value = name;
      timeInput.value = time;
      window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'});
    }
    async function deleteRecord(name){
      if (!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      const ok = confirm(`ì •ë§ \"${name}\" ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?`);
      if (!ok) return;
      await db.ref('participants/' + name).remove();
    }

    // ì‹¤ì‹œê°„ ì¡°íšŒ & ë Œë”ë§
    db.ref('participants').on('value', (snap) => {
      const data = snap.val() || {};
      const list = Object.values(data).sort((a,b) => Number(a.time) - Number(b.time));
      tbody.innerHTML = list.map((p,i)=>{
        const actionBtns = `<div class="row" style="justify-content:center">
            <button class="btn-ghost" onclick="editRecord('${p.name.replace(/'/g, "&#39;")}', '${Number(p.time)}')">ìˆ˜ì •</button>
            <button class="btn-ghost" onclick="deleteRecord('${p.name.replace(/'/g, "&#39;")}')">ì‚­ì œ</button>
          </div>`;
        return `<tr>
          <td>${i+1}</td>
          <td>${p.name}</td>
          <td>${Number(p.time).toFixed(2)}</td>
          <td class="admin-only">${actionBtns}</td>
        </tr>`;
      }).join('');
      // í—¤ë” ì•¡ì…˜ ì»¬ëŸ¼ í‘œì‹œ ìƒíƒœ ë™ê¸°í™”
      thActions.style.display = isAdmin ? '' : 'none';
      // í–‰ì˜ admin-only ë²„íŠ¼ í‘œì‹œ ê°±ì‹ 
      document.querySelectorAll('.admin-only').forEach(el => {
        if (el.tagName === 'TD' || el.id === 'thActions') el.style.display = isAdmin ? '' : 'none';
      });
    });

    // ì´ˆê¸° UI ìƒíƒœ ì„¤ì •
    applyAdminUI();
  </script>
</body>
</html>
