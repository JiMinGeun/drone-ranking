<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë“œë¡  ê²½ì£¼ ì‹¤ì‹œê°„ ìˆœìœ„</title>
  <style>
    :root { --bg1:#00bcd4; --bg2:#007bff; --glass:rgba(255,255,255,.12); --ink:#0f172a; }
    *{box-sizing:border-box}
    body{font-family:'Noto Sans KR',system-ui,Segoe UI,Roboto,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#fff;margin:0;min-height:100vh;display:flex;flex-direction:column;align-items:center;gap:14px;padding:16px}
    h1{margin:6px 0 0;text-align:center;font-size:clamp(20px,4vw,28px)}
    .wrap{width:100%;max-width:880px;display:flex;flex-direction:column;gap:12px}
    .bar,.card{background:rgba(0,0,0,.22);backdrop-filter:blur(6px);border-radius:14px;padding:14px;box-shadow:0 8px 26px rgba(0,0,0,.18)}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .sp{justify-content:space-between}
    table{width:100%;border-collapse:collapse;background:var(--glass);border-radius:12px;overflow:hidden}
    th,td{padding:11px 10px;text-align:center;border-bottom:1px solid rgba(255,255,255,.28)}
    th{background:rgba(255,255,255,.18);font-weight:700}
    tr:last-child td{border-bottom:none}
    input{padding:10px 12px;border-radius:10px;border:none;outline:none;background:#fff;color:var(--ink)}
    button{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn{background:#ffeb3b;color:#111}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,.5);color:#fff}
    .tag{display:inline-flex;padding:4px 8px;border-radius:999px;background:rgba(255,255,255,.2);font-size:12px}
    /* ê´€ë¦¬ì UIëŠ” ê¸°ë³¸ ìˆ¨ê¹€ */
    .admin-only{display:none}
    /* ë¹„ë²ˆ ëª¨ë‹¬ */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px}
    .modal .box{width:100%;max-width:380px;background:#fff;color:#111;border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .modal h3{margin:0 0 8px}
    .modal .row{justify-content:flex-end}
    .danger{background:#ef4444;color:#fff}
    .muted{opacity:.85}
  </style>
</head>
<body>
  <h1>ğŸ ë“œë¡  ê²½ì£¼ ì‹¤ì‹œê°„ ìˆœìœ„</h1>
  <div class="wrap">
    <!-- ìƒë‹¨ ë°” -->
    <div class="bar row sp">
      <div class="row"><span>ìƒíƒœ:</span><span id="state" class="tag">ê´€ëŒ ëª¨ë“œ</span></div>
      <div class="row">
        <button id="adminBtn" class="btn-ghost">ğŸ” ê´€ë¦¬ì</button>
        <button id="logoutBtn" class="btn-ghost admin-only">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <!-- ìˆœìœ„í‘œ -->
    <div class="card">
      <table>
        <thead>
          <tr>
            <th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ê¸°ë¡(ì´ˆ)</th><th id="thActions" class="admin-only">ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- ê´€ë¦¬ì ì…ë ¥ ì¹´ë“œ -->
    <div id="adminPanel" class="card admin-only">
      <h3 style="margin:6px 0 10px">ê¸°ë¡ ì¶”ê°€ / ìˆ˜ì •</h3>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <input id="nameInput" placeholder="ì´ë¦„" />
        <input id="timeInput" type="number" step="0.01" placeholder="ê¸°ë¡(ì´ˆ)" />
        <button id="saveBtn" class="btn">ë“±ë¡/ì—…ë°ì´íŠ¸</button>
        <button id="resetBtn" class="btn-ghost danger">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
      <p class="muted" style="margin:8px 0 0">â€» ê°™ì€ ì´ë¦„ì„ ë‹¤ì‹œ ì €ì¥í•˜ë©´ ê¸°ë¡ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <!-- ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
  <div id="pwModal" class="modal" aria-hidden="true">
    <div class="box">
      <h3>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
      <input id="pwInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="width:100%" />
      <div class="row" style="margin-top:10px">
        <button id="pwCancel" class="btn-ghost">ì·¨ì†Œ</button>
        <button id="pwOk" class="btn">í™•ì¸</button>
      </div>
      <p class="muted" style="margin-top:6px">í–‰ì‚¬ìš© ê°„ë‹¨ ë³´í˜¸ì…ë‹ˆë‹¤. ê°•í•œ ë³´ì•ˆì´ í•„ìš”í•˜ë©´ Firebase Authenticationì„ ì‚¬ìš©í•˜ì„¸ìš”.</p>
    </div>
  </div>

  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>

  <script>
    // Firebase ì„¤ì • (ë‹¹ì‹  í”„ë¡œì íŠ¸)
    const firebaseConfig = {
      apiKey: "AIzaSyDQdYziYofadFexbv9CjgaSDoV701kJq7eo",
      authDomain: "studio-1121796292-145f8.firebaseapp.com",
      databaseURL: "https://studio-1121796292-145f8-default-rtdb.firebaseio.com",
      projectId: "studio-1121796292-145f8",
      storageBucket: "studio-1121796292-145f8.appspot.com",
      messagingSenderId: "505956643695",
      appId: "1:505956643695:web:6766fd9a4cb3b87d35409a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ê°„ì´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (í•„ìš”ì‹œ ë³€ê²½)
    const ADMIN_PASSWORD = "droneadmin";

    // ìƒíƒœ
    let isAdmin = false;

    // DOM
    const state = document.getElementById('state');
    const adminBtn = document.getElementById('adminBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const adminPanel = document.getElementById('adminPanel');
    const thActions = document.getElementById('thActions');
    const tbody = document.getElementById('tbody');

    const nameInput = document.getElementById('nameInput');
    const timeInput = document.getElementById('timeInput');
    const saveBtn = document.getElementById('saveBtn');
    const resetBtn = document.getElementById('resetBtn');

    const pwModal = document.getElementById('pwModal');
    const pwInput = document.getElementById('pwInput');
    const pwOk = document.getElementById('pwOk');
    const pwCancel = document.getElementById('pwCancel');

    // ê³µí†µ: ê´€ë¦¬ì UI í† ê¸€
    function applyAdminUI(){
      document.querySelectorAll('.admin-only').forEach(el=>{ el.style.display = isAdmin ? '' : 'none'; });
      adminPanel.style.display = isAdmin ? '' : 'none';
      thActions.style.display = isAdmin ? '' : 'none';
      state.textContent = isAdmin ? 'ê´€ë¦¬ì ëª¨ë“œ' : 'ê´€ëŒ ëª¨ë“œ';
      adminBtn.textContent = isAdmin ? 'ğŸ” ê´€ë¦¬ì(ON)' : 'ğŸ” ê´€ë¦¬ì';
      logoutBtn.style.display = isAdmin ? '' : 'none';
      render();
    }

    // ëª¨ë‹¬ ì—´ê³ ë‹«ê¸°
    function openModal(){ pwModal.style.display='flex'; pwInput.value=''; pwInput.focus(); }
    function closeModal(){ pwModal.style.display='none'; }

    adminBtn.onclick = ()=>{ if(!isAdmin) openModal(); };
    pwCancel.onclick = closeModal;
    pwOk.onclick = ()=>{
      if(pwInput.value === ADMIN_PASSWORD){
        isAdmin = true; closeModal(); applyAdminUI(); alert('ê´€ë¦¬ì ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
    };
    logoutBtn.onclick = ()=>{ isAdmin = false; applyAdminUI(); };

    // ë°ì´í„° ì¡°ì‘
    async function saveRecord(){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      const name=(nameInput.value||'').trim();
      const time=parseFloat(timeInput.value);
      if(!name || isNaN(time)) return alert('ì´ë¦„ê³¼ ê¸°ë¡(ì´ˆ)ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      await db.ref('participants/'+name).set({name,time});
      nameInput.value=''; timeInput.value='';
    }
    async function removeAll(){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      if(confirm('ì •ë§ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')) await db.ref('participants').remove();
    }
    function editRecord(name,time){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      nameInput.value=name; timeInput.value=time; window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
    }
    async function deleteRecord(name){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      if(confirm(`ì •ë§ "${name}" ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?`)) await db.ref('participants/'+name).remove();
    }

    saveBtn.onclick = saveRecord;
    resetBtn.onclick = removeAll;

    // ë Œë”ë§
    let cached = [];
    function render(){
      const list = [...cached].sort((a,b)=>Number(a.time)-Number(b.time));
      tbody.innerHTML = list.map((p,i)=>{
        const actions = isAdmin ? `
          <td class="admin-only">
            <div class="row" style="justify-content:center">
              <button class="btn-ghost" onclick="editRecord('${p.name.replace(/'/g,"&#39;")}', ${Number(p.time)})">ìˆ˜ì •</button>
              <button class="btn-ghost danger" onclick="deleteRecord('${p.name.replace(/'/g,"&#39;")}')">ì‚­ì œ</button>
            </div>
          </td>` : '<td class="admin-only"></td>';
        return `<tr>
          <td>${i+1}</td>
          <td>${p.name}</td>
          <td>${Number(p.time).toFixed(2)}</td>
          ${actions}
        </tr>`;
      }).join('');
    }

    // ì‹¤ì‹œê°„ êµ¬ë…
    db.ref('participants').on('value', snap => {
      const data = snap.val() || {}; cached = Object.values(data); render();
    });

    // ì´ˆê¸° UI
    applyAdminUI();

    // ì „ì—­ì—ì„œ ì“°ëŠ” í•¸ë“¤ëŸ¬ ë…¸ì¶œ (í…Œì´ë¸” onclickìš©)
    window.editRecord = editRecord;
    window.deleteRecord = deleteRecord;
  </script>
</body>
</html>
