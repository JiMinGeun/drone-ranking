<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë“œë¡  ë ˆì´ì‹±</title>
  <style>
    :root{
      --bg:#f6f4ff;
      --ink:#0f172a;
      --card:#ffffff;
      --muted:#6b7280;
      --primary:#7c3aed;
      --primary-ink:#f5f3ff;
      --accent:#f59e0b;
      --danger:#ef4444
      --line:#e9eaf0;
      --ring:#c4b5fd;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Pretendard','Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:var(--ink);
      background:linear-gradient(180deg,#f7f2ff, #f1eaff 60%, #efe7ff);
      font-size: clamp(15px, 2.4vw, 17px);
      line-height: 1.55;
    }

    /* í—¤ë” */
/* í—¤ë” */
header {
  position: sticky;
  top: 0;
  backdrop-filter: saturate(180%) blur(8px);
  background: #ffffffcc;
  border-bottom: 1px solid #ffffff;
}

header .inner {
  max-width: 980px;
  margin: 0 auto;
  padding: 14px 20px;
  display: flex;
  align-items: center;
  justify-content: center; /* ê°€ìš´ë° ê¸°ì¤€ */
  position: relative;      /* ìì‹ absolute ê¸°ì¤€ */
}

.logo {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 900;
  letter-spacing: .8px;
  position: absolute;
  left: 20px;              /* ì™¼ìª½ ê³ ì • */
  top: 50%;
  transform: translateY(-50%);
}

header .inner > div:last-child {
  position: absolute;
  right: 20px;             /* ì˜¤ë¥¸ìª½ ê³ ì • */
  top: 50%;
  transform: translateY(-50%);
}

.logo img {
  height: clamp(28px, 6vw, 50px);
  width: auto;
  border-radius: 50%;
}

.title-center {
  font-weight: 900;
  font-size: clamp(16px, 4.5vw, 20px);
  text-align: center;
  color: var(--ink);
  letter-spacing: .4px;
}


    /* ë²„íŠ¼ */
    .btn{border:0; cursor:pointer; display:inline-flex; align-items:center; gap:8px; padding:clamp(8px,1.8vw,10px) clamp(10px,3vw,14px); border-radius:14px; font-weight:700; position:relative; transition: transform .06s ease, box-shadow .2s ease, filter .2s ease;}
    .btn:active{ transform: translateY(1px); }
    .btn:focus-visible{ outline:2px solid var(--ring); outline-offset:2px }
    .btn-primary{background:linear-gradient(180deg,#8b5cf6, #7c3aed); color:var(--primary-ink)}
    .btn-primary:hover{filter:brightness(1.03)}
    .btn-ghost{background:#fff; color:var(--ink); border:1px solid var(--line)}
    .btn-ghost:hover{ background:#fafafa; }
    .btn-danger{background:var(--danger); color:#fff}
    .btn-danger:hover{ filter:brightness(1.03) }

    .container{max-width:980px; margin:0 auto; padding:clamp(12px,4vw,20px)}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:20px;
      box-shadow:0 6px 18px rgba(17,12,46,.05);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .card:hover{ transform: translateY(-2px); box-shadow: 0 10px 26px rgba(17,12,46,.08); }

    /* í‘œ(ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿) */
    .ranking{overflow:hidden}
    .table-wrap{ position:relative; max-height: 65vh; overflow:auto; border-radius:12px; border:1px solid var(--line) }
    table{width:100%; border-collapse:separate; border-spacing:0}
    thead th{
      position: sticky; top:0; z-index:1;
      background:#fff; font-size:12px; letter-spacing:.5px; color:#6b7280; text-align:left;
      padding:12px 16px; border-bottom:1px solid var(--line)
    }
    tbody td{padding:14px 16px; border-bottom:1px solid var(--line)}
    tbody tr:nth-child(odd){background:#fafafa}
    tbody tr:hover{ background:#fafaff }

    .rank-badge{font-weight:800; display:flex; align-items:center; gap:10px}
    .medal{width:24px; height:24px; display:inline-grid; place-items:center; border-radius:999px; font-size:14px; border:1px solid #0001; box-shadow: inset 0 0 0 2px #fff6;}
    .medal.gold{  background: radial-gradient(circle at 30% 30%, #fff4bf, #f5d14b); color:#7c4a00 }
    .medal.silver{background: radial-gradient(circle at 30% 30%, #eef2ff, #c7d2fe); color:#364152 }
    .medal.bronze{background: radial-gradient(circle at 30% 30%, #ffd9b0, #f5b36b); color:#7a3d00 }
    .name{font-weight:700}
    .sub{font-size:12px; color:#6b7280; margin-top:4px}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-weight:700; letter-spacing:.6px}

    /* ëª¨ë°”ì¼ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ */
    .list-cards{display:none}
    .list-card{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 14px; border:1px solid var(--line); border-radius:12px; background:#fff;
      box-shadow: 0 4px 10px rgba(17,12,46,.04);
    }
    .list-card .who{display:flex; align-items:flex-start; gap:10px}
    .list-card .names{display:flex; flex-direction:column}
    .list-card .klass{font-size:12px; color:var(--muted)}
    .list-card .time{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-weight:700; font-size:15px}

    /* ê´€ë¦¬ì ì˜ì—­ */
    .adminHeader{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
    .actions{display:flex; gap:8px}
    .actions .btn{ width:36px; height:36px; padding:0; justify-content:center; border-radius:999px; }
    .actions .btn-ghost{ border-color:transparent; }
    .actions .btn-ghost:hover{ background:#f3f4f6; }

    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; transition: opacity .18s ease; z-index: 9999;}
    .modal::before { content: ''; position: absolute; inset: 0; background: rgba(0, 0, 0, 0.35); backdrop-filter: blur(4px); z-index: 0;}
    .modal .box{position:relative; z-index:1; width:100%; max-width:440px; background:#fff; border-radius:16px; padding:18px; animation: pop .18s ease }
    .form-row{display:flex; gap:8px; margin-top:10px}
    input{flex:1; padding:12px 12px; border-radius:12px; border:1px solid #e5e7eb; font-size:14px}
    input:focus{ outline:2px solid var(--ring); outline-offset:2px; border-color: transparent }

    .hidden{display:none !important}

    /* ë¹ˆ ìƒíƒœ + ìŠ¤ì¼ˆë ˆí†¤ */
    .empty{ padding:28px 16px; text-align:center; color:var(--muted); }
    .empty .emoji{ font-size:22px; display:block; margin-bottom:6px; }

    .row-flash{ animation: flashRow 1.4s ease }
    @keyframes flashRow{ 0%{ background:#fdf4ff } 50%{ background:#fff } 100%{ background:#fff } }

    @keyframes sk{0%{background-position:0 0}100%{background-position:200% 0}}
    @keyframes pop{from{ transform: scale(.97); opacity:.7 } to{ transform: scale(1); opacity:1 }}

    .input-error{ border-color:#fecaca !important; background:#fff1f2 }
    .hint{ font-size:12px; color:var(--muted); margin-top:6px }

    /* ì ‘ê·¼ì„± */
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    /* ë°˜ì‘í˜• */
    @media (max-width: 540px){
      .ranking table{display:none}
      .list-cards{display:flex; flex-direction:column; gap:10px}
      .list-card{ align-items:flex-start }
      .list-card .who{ gap:12px }
      .list-card .names .name{ line-height:1.2 }
      .list-card .time{ margin-left:auto }
    }
    @media (max-width: 360px){
      .logo span{display:none}
      .title-center{font-size:16px}
    }

    /* ë‹¤í¬ëª¨ë“œ (ì„ íƒì ) */
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b0c10; --ink:#eef2ff; --card:#0f1220; --muted:#a3aed0; --line:#1b1f33; --primary:#a78bfa; --primary-ink:#0b0c10; }
      body{ background:linear-gradient(180deg,#0d0f1a, #0c0f1a 60%, #0c0e19) }
      header{ background:#0f1220cc; border-bottom:1px solid #0f1220 }
      .btn-ghost{ background:#0f1220; border-color:#1b1f33; color:var(--ink) }
      .table-wrap{ border-color:#1b1f33 }
      thead th{ background:#0f1220 }
      tbody tr:hover{ background:#131733 }
    }

    /* ì´ë¯¸ì§€ ë³´í˜¸ */
    img{max-width:100%; height:auto}
    #pwModal .box {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      gap: 16px; /* ì œëª©-ì…ë ¥ì°½-ë²„íŠ¼ ì‚¬ì´ ì—¬ë°± */
    }
    
    #pwModal h3 {
      margin-bottom: 8px; /* ì œëª© ì•„ë˜ ê°„ê²© */
    }
    
    #pwModal input {
      text-align: center;
      width: 80%;
      max-width: 300px;
      padding: 12px;
      margin-bottom: 10px; /* ì…ë ¥ì°½ ì•„ë˜ ê°„ê²© */
    }
    
    /* ë²„íŠ¼ í–‰ ê°„ê²© ì¶”ê°€ */
    #pwModal .form-row {
      justify-content: center;
      gap: 10px;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <header>
    <div class="inner">
      <div class="logo">
        <img src="drone.png" alt="DOGO ë¡œê³ " style="width:100px; height:auto;">
      </div>
      <div class="title-center">ë“œë¡  ë ˆì´ì‹±</div>
      <div>
        <button id="adminBtn" class="btn btn-ghost" type="button">Admin</button>
        <button id="logoutBtn" class="btn btn-ghost hidden" type="button">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- ê³µê°œ ë­í‚¹ ë·° -->
    <section id="viewPublic">
      <div class="card ranking">
        <h3 class="title-center" style="color:var(--primary); margin:0 0 8px">ì‹¤ì‹œê°„ ë­í‚¹</h3>
        <p class="sub" style="margin:0 0 16px; text-align:center">
        </p>

        <!-- ë°ìŠ¤í¬í†±/íƒœë¸”ë¦¿: í‘œ -->
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th scope="col">RANK</th>
                <th scope="col">NAME</th>
                <th scope="col">CLASS</th>
                <th scope="col">TIME</th>
              </tr>
            </thead>
            <tbody id="tbodyPublic"></tbody>
          </table>
        </div>
        <!-- ëª¨ë°”ì¼: ì¹´ë“œ -->
        <div id="cardsPublic" class="list-cards" aria-hidden="true"></div>
      </div>
    </section>

    <!-- ê´€ë¦¬ì ë·° -->
    <section id="viewAdmin" class="hidden" aria-label="ê´€ë¦¬ì í™”ë©´">
      <div class="adminHeader">
        <button id="backBtn" class="btn btn-primary" type="button">â† ë’¤ë¡œê°€ê¸°</button>
        <button id="addBtn" class="btn btn-primary" type="button">ï¼‹ ì¶”ê°€í•˜ê¸°</button>
      </div>
      <div class="card">
        <h3 style="margin:6px 0 14px">ê¸°ë¡ ê´€ë¦¬</h3>
        <div class="table-wrap">
          <table class="table-admin">
            <thead>
              <tr>
                <th scope="col">Name</th>
                <th scope="col">Class</th>
                <th scope="col">Time</th>
                <th scope="col">Actions</th>
              </tr>
            </thead>
            <tbody id="tbodyAdmin"></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <!-- ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
  <div id="pwModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="ê´€ë¦¬ì ì½”ë“œ ì…ë ¥">
    <div class="box" style="justify-content:center">
      <h3 style="margin:0 0 10px">ê´€ë¦¬ì ì½”ë“œ</h3>
      <input id="pwInput" type="password" placeholder="ì½”ë“œ ì…ë ¥" aria-label="ê´€ë¦¬ì ì½”ë“œ"/>
      <div class="form-row" style="justify-content:space-between; width:90%">
        <button id="pwCancel" class="btn btn-ghost" type="button">ì·¨ì†Œ</button>
        <button id="pwOk" class="btn btn-primary" type="button">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="formModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-label="ê¸°ë¡ ì¶”ê°€ ë˜ëŠ” ìˆ˜ì •">
    <div class="box">
      <h3 id="formTitle" style="margin:0 0 10px">ê¸°ë¡ ì¶”ê°€</h3>
      <div class="form-row">
        <input id="nameInput" placeholder="ì´ë¦„" aria-label="ì´ë¦„ ì…ë ¥"/>
        <input id="classInput" placeholder="í•™ê¸‰ (ì˜ˆ: ê³ 1-3)" aria-label="í•™ê¸‰ ì…ë ¥"/>
      </div>
      <div class="form-row">
        <input id="timeInput" placeholder="ê¸°ë¡ (ì˜ˆ: 05:07.008 ë˜ëŠ” 307.008)" aria-label="ê¸°ë¡ ì‹œê°„ ì…ë ¥"/>
      </div>
      <p class="hint">í˜•ì‹ ì˜ˆ: <code>02:15.125</code> ë˜ëŠ” <code>135.125</code></p>
      <div class="form-row" style="justify-content:flex-end">
        <button id="formCancel" class="btn btn-ghost" type="button">ì·¨ì†Œ</button>
        <button id="formSave" class="btn btn-primary" type="button">ì €ì¥</button>
      </div>
    </div>
  </div>

  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>

  <script>
    // ===== Firebase ì„¤ì • =====
    const firebaseConfig = {
      apiKey: "AIzaSyDQdYziYofadFexbv9CjgaSDoV701kJq7eo",
      authDomain: "studio-1121796292-145f8.firebaseapp.com",
      databaseURL: "https://studio-1121796292-145f8-default-rtdb.firebaseio.com",
      projectId: "studio-1121796292-145f8",
      storageBucket: "studio-1121796292-145f8.appspot.com",
      messagingSenderId: "505956643695",
      appId: "1:505956643695:web:6766fd9a4cb3b87d35409a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ===== ê°„ì´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ =====
    const ADMIN_PASSWORD = "dogae123!";

    // ===== ìƒíƒœ / DOM =====
    let isAdmin = JSON.parse(sessionStorage.getItem('isAdmin') || 'false');
    let editingKey = null; // í¸ì§‘ ì¤‘ í‚¤ (ì´ë¦„ ê¸°ë°˜)
    let lastTopName = null; // 1ìœ„ í•˜ì´ë¼ì´íŠ¸ ë¹„êµìš©

    const viewPublic = document.getElementById('viewPublic');
    const viewAdmin  = document.getElementById('viewAdmin');
    const tbodyPublic = document.getElementById('tbodyPublic');
    const tbodyAdmin  = document.getElementById('tbodyAdmin');
    const cardsPublic = document.getElementById('cardsPublic');

    const adminBtn = document.getElementById('adminBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const backBtn = document.getElementById('backBtn');
    const addBtn = document.getElementById('addBtn');

    const pwModal = document.getElementById('pwModal');
    const pwInput = document.getElementById('pwInput');
    const pwOk = document.getElementById('pwOk');
    const pwCancel = document.getElementById('pwCancel');

    const formModal = document.getElementById('formModal');
    const formTitle = document.getElementById('formTitle');
    const nameInput = document.getElementById('nameInput');
    const classInput = document.getElementById('classInput');
    const timeInput = document.getElementById('timeInput');
    const formSave = document.getElementById('formSave');
    const formCancel = document.getElementById('formCancel');

    // ===== ìœ í‹¸ =====
    const esc = s => String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));

    function parseTimeToMs(v){
      // ì…ë ¥: "mm:ss.mmm" ë˜ëŠ” ì´ì´ˆ(ì´ˆ.ë°€ë¦¬)
      const s = String(v).trim();
      if(!s) return NaN;
      if(s.includes(':')){
        const [mm, rest] = s.split(':');
        const [ss, ms='0'] = rest.split('.');
        const minutes = parseInt(mm,10)||0;
        const seconds = parseInt(ss,10)||0;
        const millis  = parseInt(String(ms).padEnd(3,'0').slice(0,3),10)||0;
        return (minutes*60 + seconds)*1000 + millis;
      }
      const num = Number(s);
      if(isNaN(num)) return NaN;
      return Math.round(num*1000);
    }
    function formatMs(ms){
      if(ms==null || isNaN(ms)) return '-';
      const total = Math.max(0, Math.round(ms));
      const minutes = Math.floor(total/60000);
      const seconds = Math.floor((total%60000)/1000);
      const millis  = total%1000;
      const mm = String(minutes).padStart(2,'0');
      const ss = String(seconds).padStart(2,'0');
      const mmm= String(millis).padStart(3,'0');
      return `${mm}:${ss}.${mmm}`;
    }

    function toggleView(){
      viewPublic.classList.toggle('hidden', isAdmin);
      viewAdmin.classList.toggle('hidden', !isAdmin);
      adminBtn.classList.toggle('hidden', isAdmin);
      logoutBtn.classList.toggle('hidden', !isAdmin);
      sessionStorage.setItem('isAdmin', JSON.stringify(isAdmin));
    }
    function open(el){ el.style.display='flex'; el.setAttribute('aria-hidden','false'); }
    function close(el){ el.style.display='none'; el.setAttribute('aria-hidden','true'); }

    // ===== ì´ˆê¸° ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ =====
    function showSkeleton(){
      const rows = Array.from({length:6}, ()=>(
        `<tr>
          <td colspan="4" style="padding:14px 16px">
            <div style="height:16px; background:linear-gradient(90deg,#eee,#f5f5f9,#eee); background-size:200% 100%; border-radius:8px; animation: sk 1.2s infinite linear;"></div>
          </td>
        </tr>`
      )).join('');
      tbodyPublic.innerHTML = rows;
    }
    showSkeleton();

    // ===== ëª¨ë‹¬/ë²„íŠ¼ ë™ì‘ =====
    adminBtn.onclick = ()=>{ if(!isAdmin){ open(pwModal); pwInput.value=''; pwInput.focus(); } };
    pwOk.onclick = ()=>{
      if(pwInput.value === ADMIN_PASSWORD){ isAdmin = true; toggleView(); close(pwModal); }
      else alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
    }
    pwCancel.onclick = ()=> close(pwModal);
    logoutBtn.onclick = ()=>{ isAdmin=false; toggleView(); };
    backBtn.onclick = ()=>{ isAdmin=false; toggleView(); };

    // Enterë¡œ ëª¨ë‹¬ ì œì¶œ
    pwInput.addEventListener('keydown', e=>{ if(e.key==='Enter') pwOk.click(); });
    [nameInput, classInput, timeInput].forEach(inp=>{
      inp.addEventListener('keydown', e=>{ if(e.key==='Enter') formSave.click(); });
    });

    addBtn && (addBtn.onclick = ()=>{
      editingKey = null;
      formTitle.textContent = 'ê¸°ë¡ ì¶”ê°€';
      nameInput.value=''; classInput.value=''; timeInput.value='';
      nameInput.classList.remove('input-error'); timeInput.classList.remove('input-error');
      open(formModal); nameInput.focus();
    });
    formCancel.onclick = ()=> close(formModal);

    function validateForm(){
      nameInput.classList.remove('input-error');
      timeInput.classList.remove('input-error');
      const name = nameInput.value.trim();
      const ms = parseTimeToMs(timeInput.value);
      if(!name){ nameInput.classList.add('input-error'); }
      if(isNaN(ms)){ timeInput.classList.add('input-error'); }
      return !!(name && !isNaN(ms));
    }

    formSave.onclick = async ()=>{
      if(!validateForm()){
        alert('ì´ë¦„ê³¼ ì‹œê°„ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”. ì˜ˆ) 05:07.008 ë˜ëŠ” 307.008');
        return;
      }
      const name = nameInput.value.trim();
      const klass = classInput.value.trim();
      const ms = parseTimeToMs(timeInput.value);
      const key = editingKey || name; // ê°„ë‹¨ ë²„ì „: ì´ë¦„ì„ í‚¤ë¡œ ì‚¬ìš©
      await db.ref('participants/'+key).set({name, klass, timeMs: ms, time: (ms/1000)});
      close(formModal);
    };

    function onEdit(p){
      editingKey = p.name;
      formTitle.textContent = 'ê¸°ë¡ ìˆ˜ì •';
      nameInput.value = p.name || '';
      classInput.value = p.klass || '';
      timeInput.value = formatMs(p.timeMs ?? (Number(p.time)||0)*1000);
      nameInput.classList.remove('input-error'); timeInput.classList.remove('input-error');
      open(formModal);
    }
    async function onDelete(p){
      if(confirm(`ì •ë§ "${p.name}" ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?`)){
        await db.ref('participants/'+p.name).remove();
      }
    }

    // ===== ë Œë”ë§ =====
    let list = [];
    function renderPublic(){
      if(list.length===0){
        tbodyPublic.innerHTML = `<tr><td colspan="4">
          <div class="empty"><span class="emoji">ğŸª</span>ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤. ìƒë‹¨ Adminì—ì„œ ê¸°ë¡ì„ ì¶”ê°€í•´ ë³´ì„¸ìš”.</div>
        </td></tr>`;
      } else {
        tbodyPublic.innerHTML = list.map((p,i)=>{
          const isTop = i===0;
          const medal = i===0? 'gold' : i===1? 'silver' : i===2? 'bronze' : '';
          const badge = medal ? `<span class="medal ${medal}">ğŸ…</span>` : `<strong>${i+1}</strong>`;
          const rowClass = (isTop && p.name !== lastTopName) ? 'row-flash' : '';
          return `<tr class="${rowClass}">
            <td class="rank-badge">${badge}</td>
            <td><div class="name">${esc(p.name)}</div></td>
            <td>${esc(p.klass||'')}</td>
            <td class="mono">${formatMs(p.timeMs ?? (Number(p.time)||0)*1000)}</td>
          </tr>`;
        }).join('');
      }

      // ëª¨ë°”ì¼ ì¹´ë“œ
      if(cardsPublic){
        cardsPublic.innerHTML = list.map((p,i)=>{
          const medal = i===0? 'gold' : i===1? 'silver' : i===2? 'bronze' : '';
          const badge = medal ? `<span class="medal ${medal}">ğŸ…</span>` : `<strong>${i+1}</strong>`;
          const timeTxt = formatMs(p.timeMs ?? (Number(p.time)||0)*1000);
          return `<div class="list-card">
            <div class="who">
              <div class="rank-badge">${badge}</div>
              <div class="names">
                <div class="name">${esc(p.name)}</div>
                <div class="klass">${esc(p.klass||'')}</div>
              </div>
            </div>
            <div class="time">${timeTxt}</div>
          </div>`;
        }).join('');
      }

      if(list[0]) lastTopName = list[0].name;
    }

    function renderAdmin(){
      tbodyAdmin.innerHTML = list.map(p=>{
        return `<tr>
          <td>${esc(p.name)}</td>
          <td>${esc(p.klass||'')}</td>
          <td class="mono">${formatMs(p.timeMs ?? (Number(p.time)||0)*1000)}</td>
          <td>
            <div class="actions">
              <button class="btn btn-ghost" type="button" aria-label="í¸ì§‘" onclick='editRow("${esc(p.name)}")'>âœ</button>
              <button class="btn btn-danger" type="button" aria-label="ì‚­ì œ" onclick='deleteRow("${esc(p.name)}")'>ğŸ—‘</button>
            </div>
          </td>
        </tr>`;
      }).join('');
    }

    // ì „ì—­ í•¸ë“¤ëŸ¬(í…Œì´ë¸” ë‚´ onClickì—ì„œ ì‚¬ìš©)
    window.editRow = (name)=>{ const p = list.find(x=>x.name===name); if(p) onEdit(p); }
    window.deleteRow = async (name)=>{ const p = list.find(x=>x.name===name); if(p) await onDelete(p); }

    // ===== ì‹¤ì‹œê°„ êµ¬ë… =====
    db.ref('participants').on('value', snap => {
      const data = snap.val() || {};
      list = Object.values(data).sort((a,b)=>{
        const ams = (a.timeMs ?? (Number(a.time)||0)*1000);
        const bms = (b.timeMs ?? (Number(b.time)||0)*1000);
        return ams - bms;
      });
      renderPublic();
      renderAdmin();
    });

    // ì´ˆê¸° í‘œì‹œ
    toggleView();
  </script>
</body>
</html>









