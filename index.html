<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë“œë¡  ê²½ì£¼ ì‹¤ì‹œê°„ ìˆœìœ„</title>
  <style>
    :root{
      --bg1:#0ea5e9; --bg2:#0284c7; --ink:#0b1220;
      --glass:rgba(255,255,255,.14); --glass-2:rgba(255,255,255,.22);
      --card:rgba(4, 13, 33, .30);
      --accent:#fcd34d; /* ë²„íŠ¼ ê¸°ë³¸ */
      --danger:#ef4444; /* ì‚­ì œ/ì´ˆê¸°í™” */
      --ok:#22c55e;     /* ì„±ê³µ */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      font-family: 'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 1200px at 20% 0%, #22d3ee55, transparent 60%),
                  radial-gradient(1200px 1200px at 100% 20%, #60a5fa44, transparent 60%),
                  linear-gradient(135deg,var(--bg1),var(--bg2));
      color:#fff; margin:0; min-height:100vh; display:flex; flex-direction:column; align-items:center; gap:16px; padding:18px;
    }
    h1{margin:6px 0 0; text-align:center; font-size:clamp(22px,4vw,34px); letter-spacing:.2px; display:flex; align-items:center; gap:10px}
    h1 .flag{font-size:22px; filter: drop-shadow(0 2px 8px rgba(0,0,0,.25));}
    .wrap{width:100%; max-width:980px; display:flex; flex-direction:column; gap:14px}

    /* Cards / surfaces */
    .bar,.card{
      position:relative;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.18);
      border-radius:16px; padding:16px 18px;
      box-shadow: 0 12px 30px rgba(2, 8, 23, .28), inset 0 1px 0 rgba(255,255,255,.1);
      backdrop-filter: blur(8px);
    }
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .sp{justify-content:space-between}

    /* Text utils */
    .muted{opacity:.8; font-size:14px}

    /* Status pill */
    .tag{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:var(--glass); border:1px solid var(--glass-2); font-size:13px}
    .tag.dot::before{content:''; width:8px; height:8px; border-radius:999px; background:#94a3b8}
    .is-admin .tag.dot::before{background:#34d399}

    /* Buttons */
    button{border:none; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer; transition: transform .08s ease, box-shadow .2s ease, background .2s ease}
    .btn{background:var(--accent); color:#111; box-shadow: 0 6px 16px rgba(252, 211, 77,.35)}
    .btn:hover{transform: translateY(-1px)}
    .btn-ghost{background:rgba(255,255,255,.10); color:#fff; border:1px solid rgba(255,255,255,.22)}
    .btn-ghost:hover{background:rgba(255,255,255,.16)}
    .btn-danger{background:var(--danger); color:#fff; box-shadow: 0 6px 16px rgba(239,68,68,.35)}
    .btn-ghost-danger{background:rgba(239,68,68,.12); color:#fff; border:1px solid rgba(239,68,68,.55)}
    .btn-ghost-danger:hover{background:rgba(239,68,68,.2)}

    /* Table */
    table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:14px;}
    thead th{background:rgba(255,255,255,.18);}
    th,td{padding:12px 10px; text-align:center; border-bottom:1px solid rgba(255,255,255,.22)}
    tr:last-child td{border-bottom:none}
    tbody tr{background:rgba(255,255,255,.08)}
    tbody tr:nth-child(even){background:rgba(255,255,255,.05)}
    tbody tr:hover{background:rgba(255,255,255,.12)}

    /* Admin panel */
    #adminPanel{display:none}
    .admin-only{display:none}
    input{padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.22); outline:none; background:#ffffff; color:var(--ink); min-width:160px}

    /* Modal password */
    .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; backdrop-filter: blur(2px);}
    .modal::before{content:''; position:absolute; inset:0; background:rgba(0,0,0,.45)}
    .modal .box{position:relative; z-index:1; width:100%; max-width:420px; background:#0b1220; color:#e5e7eb; border:1px solid rgba(255,255,255,.18); border-radius:16px; padding:18px; box-shadow:0 16px 40px rgba(0,0,0,.5)}
    .modal h3{margin:0 0 10px}
    .modal .box input{width:100%}

    /* Small screens */
    @media (max-width:560px){
      .row{gap:8px}
      input{min-width:130px}
      th:nth-child(4), td:nth-child(4){ white-space:nowrap }
    }
  </style>
</head>
<body>
  <h1><span class="flag">ğŸ</span> ë“œë¡  ê²½ì£¼ ì‹¤ì‹œê°„ ìˆœìœ„</h1>
  <div class="wrap">
    <!-- ìƒë‹¨ ë°” -->
    <div class="bar row sp">
      <div class="row"><span class="muted">ìƒíƒœ:</span><span id="state" class="tag dot">ê´€ëŒ ëª¨ë“œ</span></div>
      <div class="row">
        <button id="adminBtn" class="btn-ghost" type="button">ğŸ” ê´€ë¦¬ì</button>
        <button id="logoutBtn" class="btn-ghost admin-only" type="button">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
    </div>

    <!-- ìˆœìœ„í‘œ -->
    <div class="card">
      <table>
        <thead>
          <tr>
            <th>ìˆœìœ„</th><th>ì´ë¦„</th><th>ê¸°ë¡(ì´ˆ)</th><th id="thActions" class="admin-only">ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <!-- ê´€ë¦¬ì ì…ë ¥ ì¹´ë“œ -->
    <div id="adminPanel" class="card admin-only">
      <h3 style="margin:6px 0 10px">ê¸°ë¡ ì¶”ê°€ / ìˆ˜ì •</h3>
      <div class="row" style="gap:8px;flex-wrap:wrap">
        <input id="nameInput" placeholder="ì´ë¦„" />
        <input id="timeInput" type="number" step="0.01" placeholder="ê¸°ë¡(ì´ˆ)" />
        <button id="saveBtn" class="btn" type="button">ë“±ë¡/ì—…ë°ì´íŠ¸</button>
        <button id="resetBtn" class="btn-ghost-danger" type="button">ì „ì²´ ì´ˆê¸°í™”</button>
      </div>
      <p class="muted" style="margin:8px 0 0">â€» ê°™ì€ ì´ë¦„ì„ ë‹¤ì‹œ ì €ì¥í•˜ë©´ ê¸°ë¡ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <!-- ë¹„ë°€ë²ˆí˜¸ ëª¨ë‹¬ -->
  <div id="pwModal" class="modal" aria-hidden="true">
    <div class="box">
      <h3>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</h3>
      <input id="pwInput" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" style="width:100%" />
      <div class="row" style="margin-top:10px">
        <button id="pwCancel" class="btn-ghost" type="button">ì·¨ì†Œ</button>
        <button id="pwOk" class="btn" type="button">í™•ì¸</button>
      </div>
      <p class="muted" style="margin-top:6px">í–‰ì‚¬ìš© ê°„ë‹¨ ë³´í˜¸ì…ë‹ˆë‹¤. ê°•í•œ ë³´ì•ˆì´ í•„ìš”í•˜ë©´ Firebase Authenticationì„ ì‚¬ìš©í•˜ì„¸ìš”.</p>
    </div>
  </div>

  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-database-compat.js"></script>

  <script>
    // Firebase ì„¤ì • (ë‹¹ì‹  í”„ë¡œì íŠ¸)
    const firebaseConfig = {
      apiKey: "AIzaSyDQdYziYofadFexbv9CjgaSDoV701kJq7eo",
      authDomain: "studio-1121796292-145f8.firebaseapp.com",
      databaseURL: "https://studio-1121796292-145f8-default-rtdb.firebaseio.com",
      projectId: "studio-1121796292-145f8",
      storageBucket: "studio-1121796292-145f8.appspot.com",
      messagingSenderId: "505956643695",
      appId: "1:505956643695:web:6766fd9a4cb3b87d35409a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ê°„ì´ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (í•„ìš”ì‹œ ë³€ê²½)
    const ADMIN_PASSWORD = "dogae123!";

    // ìƒíƒœ
    let isAdmin = JSON.parse(sessionStorage.getItem('isAdmin') || 'false');

    // DOM
    const state = document.getElementById('state');
    const adminBtn = document.getElementById('adminBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const adminPanel = document.getElementById('adminPanel');
    const thActions = document.getElementById('thActions');
    const tbody = document.getElementById('tbody');

    const nameInput = document.getElementById('nameInput');
    const timeInput = document.getElementById('timeInput');
    const saveBtn = document.getElementById('saveBtn');
    const resetBtn = document.getElementById('resetBtn');

    const pwModal = document.getElementById('pwModal');
    const pwInput = document.getElementById('pwInput');
    const pwOk = document.getElementById('pwOk');
    const pwCancel = document.getElementById('pwCancel');

    // ìœ í‹¸: HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHTML(str){
      return String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }

    // ê³µí†µ: ê´€ë¦¬ì UI í† ê¸€
    function applyAdminUI(){
      document.querySelectorAll('.admin-only').forEach(el=>{ el.style.display = isAdmin ? '' : 'none'; });
      adminPanel.style.display = isAdmin ? '' : 'none';
      if(thActions) thActions.style.display = isAdmin ? '' : 'none';
      state.textContent = isAdmin ? 'ê´€ë¦¬ì ëª¨ë“œ' : 'ê´€ëŒ ëª¨ë“œ';
      adminBtn.textContent = isAdmin ? 'ğŸ” ê´€ë¦¬ì(ON)' : 'ğŸ” ê´€ë¦¬ì';
      logoutBtn.style.display = isAdmin ? '' : 'none';
      document.body.classList.toggle('is-admin', isAdmin);
      sessionStorage.setItem('isAdmin', JSON.stringify(isAdmin));
      render();
    }

    // ëª¨ë‹¬ ì—´ê³ ë‹«ê¸°
    function openModal(){ pwModal.style.display='flex'; pwInput.value=''; pwInput.focus(); }
    function closeModal(){ pwModal.style.display='none'; }

    // ëª¨ë‹¬ í‚¤ë³´ë“œ ë™ì‘
    pwModal.addEventListener('keydown', (e)=>{
      if(e.key==='Enter') pwOk.click();
      if(e.key==='Escape') closeModal();
    });

    adminBtn.onclick = ()=>{ if(!isAdmin) openModal(); };
    pwCancel.onclick = closeModal;
    pwOk.onclick = ()=>{
      if(pwInput.value === ADMIN_PASSWORD){
        isAdmin = true; closeModal(); applyAdminUI();
        alert('ê´€ë¦¬ì ëª¨ë“œë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
      } else { alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); }
    };
    logoutBtn.onclick = ()=>{ isAdmin = false; applyAdminUI(); };

    // ë°ì´í„° ì¡°ì‘
    async function saveRecord(){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      const name=(nameInput.value||'').trim();
      const time=parseFloat(timeInput.value);
      if(!name || isNaN(time)) return alert('ì´ë¦„ê³¼ ê¸°ë¡(ì´ˆ)ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
      await db.ref('participants/'+name).set({name,time});
      nameInput.value=''; timeInput.value='';
    }
    async function removeAll(){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      if(confirm('ì •ë§ ì „ì²´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?')) await db.ref('participants').remove();
    }
    function editRecord(name,time){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      nameInput.value=name; timeInput.value=time; window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
    }
    async function deleteRecord(name){
      if(!isAdmin) return alert('ê´€ë¦¬ìë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
      if(confirm(`ì •ë§ "${name}" ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?`)) await db.ref('participants/'+name).remove();
    }

    saveBtn.onclick = saveRecord;
    resetBtn.onclick = removeAll;

    // ë Œë”ë§
    let cached = [];
    function render(){
      const list = [...cached].sort((a,b)=>Number(a.time)-Number(b.time));
      if(list.length===0){
        tbody.innerHTML = `<tr><td colspan="4" class="muted">ì•„ì§ ì°¸ê°€ìê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ë¡ì„ ì¶”ê°€í•´ ì£¼ì„¸ìš”.</td></tr>`;
        return;
      }
      tbody.innerHTML = list.map((p,i)=>{
        const actions = isAdmin ? `
          <td class="admin-only">
            <div class="row" style="justify-content:center">
              <button class="btn-ghost" onclick="editRecord('${escapeHTML(p.name)}', ${Number(p.time)})">ìˆ˜ì •</button>
              <button class="btn-ghost-danger" onclick="deleteRecord('${escapeHTML(p.name)}')">ì‚­ì œ</button>
            </div>
          </td>` : '<td class="admin-only"></td>';
        return `<tr>
          <td>${i+1}</td>
          <td>${escapeHTML(p.name)}</td>
          <td>${Number(p.time).toFixed(2)}</td>
          ${actions}
        </tr>`;
      }).join('');
    }

    // ì‹¤ì‹œê°„ êµ¬ë…
    db.ref('participants').on('value', snap => {
      const data = snap.val() || {}; cached = Object.values(data); render();
    });

    // ì´ˆê¸° UI
    applyAdminUI();

    // ì „ì—­ì—ì„œ ì“°ëŠ” í•¸ë“¤ëŸ¬ ë…¸ì¶œ (í…Œì´ë¸” onclickìš©)
    window.editRecord = editRecord;
    window.deleteRecord = deleteRecord;
  </script>
</body>
</html>
